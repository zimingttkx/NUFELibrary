# 图书馆座位预约 - 纯终端版

## 📖 简介

这是图书馆座位自动预约系统的**纯终端CLI版本**，无需任何界面，可在任何平台上运行。

### ✨ 特点

- 🖥️ **纯终端交互** - 无需Web界面，命令行操作
- 🎯 **极简设计** - 只保留核心功能（Cookie管理 + 明日预约）
- 🔄 **跨平台** - Windows/Linux/Mac 通用
- 📦 **零配置** - 开箱即用
- 🚀 **轻量级** - 核心依赖少，启动快

## 🚀 快速开始

### 1. 安装依赖

```bash
cd cli
npm install
```

### 2. 启动程序

```bash
npm start
# 或
node cli.js
```

### 3. 首次使用

按照交互式菜单提示操作：

1. **设置Cookie** - 选择"🔑 设置Cookie"
   - 方式1：手动输入（使用抓包工具获取）
   - 方式2：扫码获取（扫描二维码后粘贴链接）

2. **配置座位** - 选择"💺 配置座位"
   - 选择图书馆
   - 输入座位号

3. **测试预约** - 选择"🧪 测试预约"
   - 验证配置是否正确

4. **启动自动预约** - 选择"⚡ 启动自动预约"
   - 程序将在19:59:55自动执行预约

## 📋 功能说明

### 主菜单

```
╔════════════════════════════════════════╗
║   📚 图书馆座位自动预约系统 (CLI版)   ║
╚════════════════════════════════════════╝

【当前配置】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Cookie状态: ✓ 已设置
座位信息: ✓ 一楼东区东一 - 179号
自动预约: ○ 未启动
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请选择操作：
  🔑 设置Cookie
  💺 配置座位
  🧪 测试预约
  ⚡ 启动自动预约
  🛑 停止自动预约
  📊 查看完整状态
  ───────────────
  ❌ 退出程序
```

### 核心功能

#### 1. Cookie管理

**手动输入**
- 使用抓包工具（如HttpCanary）获取Cookie
- 直接粘贴完整Cookie值

**扫码获取**
- 扫描二维码
- 粘贴跳转后的链接
- 自动提取并设置Cookie

#### 2. 明日预约

**自动预约时间表**
- `19:45` - 发送Cookie刷新提醒
- `19:59:55` - 自动启动预约
- `20:05:00` - 自动停止预约

**预约策略**
- WebSocket排队系统
- 700ms轮询间隔
- 自动反防刷机制
- 预约成功自动停止

## 🔧 配置文件

配置保存在 `config.json`：

```json
{
  "cookie": "Authorization=xxx; SERVERID=xxx",
  "libId": "429",
  "libName": "一楼东区东一",
  "seatName": "179",
  "seatKey": "32,3",
  "libList": [...],
  "autoReserve": false
}
```

## 📝 使用技巧

### Cookie获取方法

1. **Android手机（推荐HttpCanary）**
   - 安装HttpCanary抓包工具
   - 开启抓包，打开"我去图书馆"公众号
   - 在明日预约开放前1小时内抓包
   - 找到请求头中的Cookie值

2. **通过扫码**
   - 在CLI中选择"扫码获取Cookie"
   - 微信扫描二维码
   - 复制跳转后的完整链接
   - 粘贴到CLI中

### 保持程序运行

启动自动预约后，请保持程序运行：

**Linux/Mac后台运行：**
```bash
nohup node cli.js > output.log 2>&1 &
```

**Windows后台运行：**
```bash
start /B node cli.js
```

**使用PM2：**
```bash
npm install -g pm2
pm2 start cli.js --name library-reserve
```

## ⚠️ 注意事项

1. **Cookie有效期**
   - Cookie通常24小时有效
   - 建议每天更新Cookie

2. **网络要求**
   - 需要稳定的网络连接
   - WebSocket需要保持连接

3. **时间同步**
   - 确保系统时间准确
   - 建议启用NTP时间同步

4. **热门座位**
   - 热门座位竞争激烈
   - 建议配置多个备选座位（Web版功能）

## 🐛 常见问题

### Q: Cookie无效怎么办？
A: 重新抓包获取最新Cookie，或使用扫码方式获取。

### Q: 测试预约失败？
A:
1. 检查Cookie是否有效
2. 检查座位号是否正确
3. 确认在预约开放时间内

### Q: 自动预约没有执行？
A:
1. 检查系统时间是否准确
2. 确保程序保持运行
3. 查看是否有错误提示

### Q: 可以预约多个座位吗？
A: CLI版本只支持单座位预约，需要多座位请使用Web版本。

## 📂 项目结构

```
cli/
├── cli.js              # 启动脚本
├── index.js            # 主程序（交互式菜单）
├── config.json         # 配置文件
├── package.json        # 依赖配置
├── lib/
│   ├── config.js       # 配置管理
│   ├── cookie.js       # Cookie管理
│   ├── reserve.js      # 预约逻辑
│   ├── scheduler.js    # 定时任务
│   ├── websocket.js    # WebSocket连接
│   └── http.js         # HTTP请求
└── README.md           # 使用说明
```

## 🔗 相关链接

- [完整Web版本](../README_CN.md)
- [API文档](https://a164759920.github.io/I_Goto_Library/)
- [问题反馈](https://github.com/A164759920/I_Goto_Library/issues)

## 📄 许可证

MIT License

---

**开发者**: SCY
**版本**: 1.0.0 (CLI)
**最后更新**: 2025-12-07

🎉 祝你抢座成功！
