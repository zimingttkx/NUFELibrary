# 一键启动脚本使用说明

## 📦 脚本文件

项目根目录下提供了跨平台的启动脚本：

### Windows 平台
- **install.bat** - 安装依赖脚本
- **start.bat** - 一键启动脚本
- **stop.bat** - 一键停止脚本

### Linux/Mac 平台
- **install.sh** - 安装依赖脚本
- **start.sh** - 一键启动脚本
- **stop.sh** - 一键停止脚本

---

## 🚀 Windows 使用步骤

### 步骤1：首次使用 - 安装依赖

**操作**：双击运行 `install.bat`

**功能**：
- 检查 Node.js 和 npm 是否已安装
- 自动安装后端依赖（nodeServer目录）
- 自动安装前端依赖（vue目录）

**注意事项**：
- 首次安装可能需要几分钟时间，请耐心等待
- 确保网络连接正常
- 如果安装失败，可以重新运行此脚本

---

### 步骤2：启动项目

**操作**：双击运行 `start.bat`

**功能**：
- 自动启动后端服务（端口：8899）
- 自动启动前端开发服务器（端口：8080）
- 等待前端编译完成（约40秒）
- 自动在浏览器中打开前端页面

**运行效果**：
- 会弹出两个命令行窗口：
  - "图书馆后端服务"窗口
  - "图书馆前端服务"窗口
- 等待约40秒后，浏览器会自动打开 http://localhost:8080

**注意事项**：
- 请保持两个命令行窗口打开，不要关闭
- 如果端口被占用，会导致启动失败
- 前端服务启动需要一些时间，请等待"Compiled successfully"提示
- 如果浏览器打开时页面未加载，请等待编译完成后刷新页面

---

### 步骤3：使用完毕 - 停止服务

**操作**：双击运行 `stop.bat`

**功能**：
- 自动停止所有后端服务进程
- 自动停止所有前端服务进程
- 释放 8899 和 8080 端口

**其他停止方式**：
- 直接关闭两个服务窗口
- 在服务窗口中按 Ctrl+C

---

## 🐧 Linux/Mac 使用步骤

### 步骤0：首次使用 - 添加执行权限

```bash
chmod +x install.sh start.sh stop.sh
```

### 步骤1：安装依赖

```bash
./install.sh
```

**功能**：
- 检查 Node.js 和 npm 环境
- 自动安装前后端依赖
- 显示彩色提示信息

---

### 步骤2：启动项目

```bash
./start.sh
```

**功能**：
- 后台启动后端服务（端口：8899）
- 后台启动前端开发服务器（端口：8080）
- 自动创建日志文件（logs目录）
- 等待前端编译后自动打开浏览器

**日志查看**：
```bash
# 查看后端日志
tail -f logs/backend.log

# 查看前端日志（查看编译状态）
tail -f logs/frontend.log
```

**进程管理**：
- PID文件保存在 `logs/` 目录
- 后端PID: `logs/backend.pid`
- 前端PID: `logs/frontend.pid`

---

### 步骤3：停止服务

```bash
./stop.sh
```

**功能**：
- 停止所有后端和前端进程
- 清理PID文件
- 释放端口占用（8899, 8080）

---

## ⚙️ 端口配置

默认端口：
- 后端服务：8899
- 前端服务：8080

访问地址：
- 本地访问：http://localhost:8080
- 局域网访问：http://你的IP地址:8080

修改端口：
- 后端端口：编辑 `nodeServer/.env` 中的 `DEFAULT_NODE_PORT`
- 前端端口：需要修改 `vue/package.json` 中的启动配置

---

## 📂 日志文件（Linux/Mac）

启动后会在项目根目录创建 `logs/` 文件夹：

```
logs/
├── backend.log      # 后端运行日志
├── frontend.log     # 前端编译和运行日志
├── backend.pid      # 后端进程ID
└── frontend.pid     # 前端进程ID
```

---

## ❗ 常见问题

### Q1: Windows脚本双击闪退怎么办？
**A**: 右键点击脚本，选择"以管理员身份运行"

### Q2: 提示"端口被占用"怎么办？
**A**:
- Windows: 先运行 `stop.bat` 停止所有服务，然后重新启动
- Linux/Mac: 运行 `./stop.sh` 停止所有服务，然后重新启动

### Q3: 浏览器打开后提示"无网络连接"？
**A**:
1. 等待前端服务编译完成（查看"图书馆前端服务"窗口或 logs/frontend.log）
2. 看到"Compiled successfully"后刷新页面
3. 脚本会等待40秒，但首次启动可能需要更长时间
4. 可以手动等待编译完成后再访问

### Q4: 前端页面打不开怎么办？
**A**:
1. 检查两个服务是否都正常运行
2. Windows: 查看两个命令行窗口的输出
3. Linux/Mac: 运行 `tail -f logs/frontend.log` 查看编译状态
4. 等待前端编译完成（看到"Compiled successfully"）
5. 手动在浏览器访问 http://localhost:8080

### Q5: 安装依赖失败怎么办？
**A**:
1. 检查网络连接
2. 检查 Node.js 是否正确安装（运行 `node --version`）
3. 尝试切换 npm 镜像源：
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```
4. 重新运行安装脚本

### Q6: Linux/Mac 提示"Permission denied"？
**A**: 添加执行权限
```bash
chmod +x install.sh start.sh stop.sh
```

### Q7: 如何查看服务是否正常运行？
**A**:
- Windows: 查看两个命令行窗口的输出
- Linux/Mac:
  ```bash
  # 查看进程
  ps aux | grep node

  # 查看端口占用
  lsof -i :8899
  lsof -i :8080

  # 查看日志
  tail -f logs/backend.log
  tail -f logs/frontend.log
  ```

### Q8: 编译时间太长？
**A**:
- 首次编译会比较慢（1-2分钟）
- 后续启动会快很多（通常30秒左右）
- 可以根据机器性能调整 start.bat/start.sh 中的等待时间

---

## 🔧 高级使用

### 修改等待时间（如果你的机器比较慢）

**Windows (start.bat)**:
```batch
REM 找到这一行，修改等待时间（单位：秒）
timeout /t 40 /nobreak
```

**Linux/Mac (start.sh)**:
```bash
# 找到这一行，修改等待时间（单位：秒）
sleep 40
```

### 后台运行（Linux/Mac）

脚本已经默认使用 `nohup` 在后台运行，关闭终端不影响服务。

### 开机自启动（Linux）

创建 systemd 服务文件：
```bash
sudo nano /etc/systemd/system/library-booking.service
```

内容：
```ini
[Unit]
Description=Library Booking System
After=network.target

[Service]
Type=forking
User=your_username
WorkingDirectory=/path/to/NFUELibrary
ExecStart=/path/to/NFUELibrary/start.sh
ExecStop=/path/to/NFUELibrary/stop.sh
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

启用自启动：
```bash
sudo systemctl enable library-booking
sudo systemctl start library-booking
```

---

## 📞 技术支持

如遇到其他问题，请查看：
- [README_CN.md](./README_CN.md) - 完整项目文档
- [TESTING.md](./TESTING.md) - 测试说明
- [PROJECT_STATUS.md](./PROJECT_STATUS.md) - 项目状态

---

## 🌟 脚本特性对比

| 特性 | Windows | Linux/Mac |
|------|---------|-----------|
| 自动安装依赖 | ✅ | ✅ |
| 自动启动服务 | ✅ | ✅ |
| 自动打开浏览器 | ✅ | ✅ |
| 后台运行 | ❌ | ✅ |
| 日志文件 | ❌ | ✅ |
| 进程管理 | 基于窗口 | 基于PID |
| 彩色输出 | ❌ | ✅ |
| 端口检测 | ✅ | ✅ |

---

**最后更新**: 2025-11-22
**版本**: 2.0.0（跨平台支持）
