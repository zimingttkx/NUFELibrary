# 图书馆座位预约系统 - 登录使用教程

梓铭祝你天天开心 🎉

---

## 📋 目录
1. [启动系统](#1-启动系统)
2. [获取Cookie登录凭证](#2-获取cookie登录凭证)
3. [刷新场馆列表](#3-刷新场馆列表)
4. [配置座位](#4-配置座位)
5. [测试预约](#5-测试预约)
6. [添加备选座位](#6-添加备选座位可选)
7. [自动预约说明](#7-自动预约说明)
8. [常见问题](#8-常见问题)

---

## 1. 启动系统

### 步骤 1.1: 启动后端服务

打开命令行，执行以下命令：

```bash
cd nodeServer
npm run dev
```

看到以下提示表示后端启动成功：
```
✅data.json加载成功
🚀 HTTP server is running on: 8899
```

### 步骤 1.2: 启动前端服务

打开另一个命令行窗口，执行：

```bash
cd vue
npm run serve
```

看到以下提示表示前端启动成功：
```
App running at:
- Local:   http://172.20.128.1:8082/
```

### 步骤 1.3: 打开浏览器

在浏览器中访问：
- **推荐**: http://localhost:8080
- 或者: http://172.20.128.1:8082/

---

## 2. 获取Cookie登录凭证

Cookie是你的登录凭证，用于访问图书馆预约系统。有两种获取方式：

### 方式一：扫码获取（推荐） ⭐

1. **点击"预约管理"** 进入配置页面
2. **查看二维码**：页面顶部会显示一个二维码
3. **微信扫码**：使用微信扫描二维码
4. **复制链接**：
   - 扫码后会跳转到一个页面
   - 在微信中点击右上角"..."
   - 选择"复制链接"
5. **粘贴链接**：
   - 将复制的链接粘贴到"粘贴扫码后的链接"输入框中
   - 点击"提取Cookie"按钮
6. **验证成功**：看到提示"✅ 从链接提取Cookie成功！"

### 方式二：手动输入Cookie

1. **获取Cookie字符串**：
   - 在浏览器中登录图书馆预约系统
   - 打开浏览器开发者工具（F12）
   - 进入Network标签页
   - 找到请求头中的Cookie字段
   - 复制完整的Cookie值

2. **输入Cookie**：
   - 在"手动输入Cookie"部分的输入框粘贴Cookie
   - 点击"设置Cookie"按钮
   - 看到"✅set Cookie Successfully!"表示成功

---

## 3. 刷新场馆列表

**重要**：首次使用必须先刷新场馆列表！

1. **点击"刷新场馆列表"按钮**（页面底部的绿色按钮）
2. **等待加载**：系统会从图书馆服务器获取最新的场馆信息
3. **验证成功**：看到提示"✅刷新场馆列表成功，可通过下拉框查看"

如果提示"❌请先设置有效的Cookie再操作"，说明Cookie未设置或已过期，请返回步骤2重新获取。

---

## 4. 配置座位

### 步骤 4.1: 选择场馆楼层

1. **点击下拉框**："选择场馆楼层"
2. **选择场馆**：从列表中选择你想预约的图书馆和楼层
   - 格式：`[ID:xxx] 楼层 图书馆名称`
   - 例如：`[ID:101] 3F 总馆`

### 步骤 4.2: 输入座位号

1. **输入座位号**：在"输入座位号"框中输入座位编号
   - 纯数字格式：如 `179`
   - 字母+数字格式：如 `D001`

### 步骤 4.3: 保存设置

1. **点击"保存设置"按钮**
2. **验证成功**：看到提示
   ```
   ✅ 座位设置成功！
   场馆：xxx图书馆
   座位号：xxx
   ```

---

## 5. 测试预约

在正式使用自动预约前，强烈建议先测试一次！

1. **点击"测试预约"按钮**
2. **确认测试**：在弹出的对话框中点击"确定"
   - 提示：测试成功后会自动取消预约，不会占用座位
3. **等待结果**：
   - ✅ 成功：说明Cookie有效，座位配置正确
   - ❌ 失败：检查Cookie是否过期，座位是否存在

**注意**：测试预约会真实执行预约操作，但会立即取消，用于验证配置是否正确。

---

## 6. 添加备选座位（可选）

备选座位功能可以在主座位已满时自动切换到其他座位。

### 步骤 6.1: 配置备选座位

1. **选择场馆和座位**：按照步骤4的方法选择另一个座位
2. **点击"添加当前座位到备选"按钮**
3. **验证成功**：看到提示
   ```
   ✅ 添加成功
   场馆：xxx
   座位：xxx
   当前共X个备选座位
   ```

### 步骤 6.2: 管理备选座位

- **查看列表**：所有备选座位会显示在列表中
- **删除座位**：点击座位右侧的"删除"按钮
- **轮询顺序**：系统会按照列表顺序依次尝试预约

**工作原理**：
- 自动预约时，系统会按顺序尝试每个座位
- 如果当前座位已满，自动切换到下一个备选座位
- 直到成功预约或所有座位都已尝试

---

## 7. 自动预约说明

### 自动运行时间

系统会在以下时间自动执行任务：

| 时间 | 任务 | 说明 |
|------|------|------|
| **19:45** | Cookie刷新提醒 | 提醒检查Cookie是否有效 |
| **19:59:55** | 启动自动预约 | 开始抢座 |
| **20:05:00** | 关闭自动预约 | 停止预约任务 |

### 预约策略

系统采用以下策略确保抢座成功：

1. **极速排队**
   - WebSocket连接，100ms心跳
   - 每秒发送10次心跳，保持连接活跃

2. **并发请求**
   - 3个并发请求同时发送
   - 150ms周期重试
   - 提高抢座成功率

3. **智能切换**
   - 主座位满时自动切换备选座位
   - 按列表顺序依次尝试
   - 无需人工干预

4. **反防刷机制**
   - 自动刷新页面
   - 自动更新SERVERID
   - 模拟真实用户行为

### 监控预约状态

- 查看后端命令行窗口的日志输出
- 观察预约进度和结果
- 出现错误时会显示详细错误信息

---

## 8. 常见问题

### Q1: Cookie提取失败怎么办？

**A**: 可能原因：
- 扫码链接已过期（通常5分钟内有效）
- 链接格式不正确
- 网络连接问题

**解决方法**：
1. 重新扫码获取新的链接
2. 确保复制完整的链接（包括https://开头）
3. 尝试方式二：手动输入Cookie

---

### Q2: 刷新场馆列表失败？

**A**: 提示"❌请先设置有效的Cookie再操作"

**解决方法**：
1. 检查Cookie是否已设置
2. Cookie可能已过期，重新获取
3. 检查网络连接是否正常

---

### Q3: 测试预约失败？

**A**: 可能原因：
- Cookie已过期
- 座位号不存在
- 该座位不可预约（已被占用、维护中等）
- 当前时间不在预约时段

**解决方法**：
1. 重新获取Cookie
2. 检查座位号是否正确
3. 尝试其他座位
4. 确认当前是否在可预约时段

---

### Q4: Cookie多久会过期？

**A**:
- 通常24小时后过期
- 建议每天更新一次Cookie
- 系统会在19:45提醒刷新Cookie

---

### Q5: 备选座位最多可以添加几个？

**A**:
- 理论上没有上限
- 建议添加3-5个备选座位
- 太多座位会增加预约时间

---

### Q6: 自动预约时我需要做什么？

**A**:
- 无需任何操作，系统会自动运行
- 保持电脑开机和程序运行
- 确保网络连接稳定
- 可以查看日志了解预约进度

---

### Q7: 如何确认预约成功？

**A**:
- 查看后端日志输出
- 登录图书馆官网查看预约记录
- 收到图书馆系统的预约成功通知

---

### Q8: 预约失败了怎么办？

**A**: 可能原因：
- 所有座位都已满
- Cookie过期
- 网络连接中断
- 图书馆系统维护

**解决方法**：
1. 检查Cookie是否有效
2. 添加更多备选座位
3. 检查网络连接
4. 查看后端日志了解具体错误

---

## 📞 技术支持

- 📖 查看 [README_CN.md](./README_CN.md) 了解更多功能
- 📊 查看 [PROJECT_STATUS.md](./PROJECT_STATUS.md) 了解项目状态
- 🧪 查看 [TESTING.md](./TESTING.md) 了解测试指南

---

## 🎯 快速上手流程

对于新手用户，推荐按照以下流程操作：

1. ✅ 启动后端服务（nodeServer）
2. ✅ 启动前端服务（vue）
3. ✅ 在浏览器打开 http://localhost:8080
4. ✅ 点击"预约管理"
5. ✅ 扫码获取Cookie
6. ✅ 点击"刷新场馆列表"
7. ✅ 选择场馆和座位
8. ✅ 点击"保存设置"
9. ✅ 点击"测试预约"验证配置
10. ✅ （可选）添加2-3个备选座位
11. ✅ 等待19:59:55自动预约

---

## ⚡ 重要提示

1. **Cookie安全**：不要将Cookie分享给他人
2. **及时更新**：每天更新Cookie确保有效
3. **提前配置**：在19:50前完成所有配置
4. **备选座位**：建议至少添加2个备选座位
5. **保持运行**：预约期间保持程序和网络连接
6. **遵守规则**：合理使用，不要频繁测试

---

**祝你抢座成功！梓铭祝你天天开心！** 🎉

---

**最后更新**：2025-11-22
**版本**：1.0.0
**开发者**：SCY
