# ⏰ 启动倒计时功能说明

## 📋 功能概述

在实时监控页面 (`http://localhost:8899/static/status.html`) 添加了启动倒计时功能，实时显示距离每天晚上19:59:55启动抢座任务的剩余时间。

---

## 🎯 功能特性

### 1. 倒计时显示
- **大号数字显示**：小时、分钟、秒三个独立卡片
- **实时更新**：每秒自动刷新倒计时
- **当前时间**：同步显示北京时间

### 2. 关键时间点
| 时间点 | 说明 |
|--------|------|
| **19:59:55** | 系统自动启动抢座任务 |
| **20:00:00** | 图书馆正式开放抢座 |

### 3. 智能提示
- **正常状态** (>5分钟)：显示 "⏰ 距离启动倒计时"
- **即将启动** (<5分钟)：显示 "🔥 即将启动！" + 红色脉动动画
- **最后1分钟** (<60秒)：显示 "⚡ XX秒后启动！"
- **任务启动后**：自动隐藏倒计时，显示运行状态

### 4. 自动循环
- 如果当前时间已过19:59:55，自动计算到明天的19:59:55
- 每天自动重置，无需手动操作

---

## 🎨 视觉效果

### 倒计时卡片布局
```
┌─────────────────────────────────────────┐
│      ⏰ 距离启动倒计时                    │
├─────────────────────────────────────────┤
│   ┌────┐    ┌────┐    ┌────┐           │
│   │ 02 │    │ 34 │    │ 56 │           │
│   │小时│    │分钟│    │ 秒 │           │
│   └────┘    └────┘    └────┘           │
├─────────────────────────────────────────┤
│  启动时间    抢座开放    当前时间        │
│  19:59:55   20:00:00   18:25:09        │
└─────────────────────────────────────────┘
```

### 紧急状态动画
当距离启动时间 < 5分钟时：
- 倒计时卡片变为红色渐变
- 添加脉动动画效果
- 标题变为 "🔥 即将启动！"

---

## 💻 技术实现

### 核心代码逻辑

```javascript
// 1. 计算目标时间（每天19:59:55）
const targetTime = new Date();
targetTime.setHours(19, 59, 55, 0);

// 2. 如果已过今天的时间，设置为明天
if (now > targetTime) {
    targetTime.setDate(targetTime.getDate() + 1);
}

// 3. 计算时间差并更新显示
const diff = targetTime - now;
const hours = Math.floor(diff / (1000 * 60 * 60));
const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
const seconds = Math.floor((diff % (1000 * 60)) / 1000);

// 4. 每秒更新一次
setInterval(updateCountdown, 1000);
```

### 状态管理

| 状态 | 触发条件 | 显示效果 |
|------|---------|---------|
| 正常倒计时 | 距离启动 > 5分钟 | 蓝紫渐变卡片 |
| 即将启动 | 距离启动 < 5分钟 | 红粉渐变 + 脉动动画 |
| 最后冲刺 | 距离启动 < 1分钟 | 秒级提示 |
| 任务运行中 | 19:59:55后启动 | 隐藏倒计时 |

---

## 📱 响应式设计

### 桌面端
- 三个倒计时卡片横向排列
- 大号数字（48px）清晰可见
- 完整显示所有信息

### 移动端
- 自动适配小屏幕
- 倒计时卡片自动换行
- 保持可读性

---

## 🔄 与系统集成

### 1. WebSocket连接
- 倒计时独立运行，不依赖WebSocket
- WebSocket连接状态显示在右上角
- 任务启动时通过WebSocket接收通知

### 2. 任务启动流程
```
倒计时 → 19:59:55 → 系统自动启动 → 隐藏倒计时 → 显示运行状态
```

### 3. 页面刷新
- 刷新页面后倒计时自动恢复
- 保持与服务器时间同步
- 不影响后台任务运行

---

## 🎯 使用场景

### 场景1：提前查看
用户可以在任何时间打开监控页面，查看距离今晚抢座还有多久。

### 场景2：实时监控
在19:59:55前几分钟打开页面，观看倒计时归零，见证任务启动。

### 场景3：跨天使用
如果在20:00:00之后打开页面，倒计时会自动显示到明天的19:59:55。

---

## 🎨 样式定制

### 颜色方案
```css
/* 正常状态 */
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* 紧急状态 */
background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
```

### 动画效果
```css
/* 脉动动画 */
@keyframes countdown-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}
```

---

## 📊 显示信息

### 倒计时卡片
- **小时**：00-23
- **分钟**：00-59
- **秒**：00-59

### 信息栏
- **启动时间**：固定显示 19:59:55
- **抢座开放**：固定显示 20:00:00
- **当前时间**：实时更新的北京时间

---

## 🚀 访问方式

### 方式1：直接访问
```
http://localhost:8899/static/status.html
```

### 方式2：从主页跳转
1. 打开前端主页：`http://localhost:8080`
2. 点击"实时监控"卡片
3. 自动打开监控页面

---

## ✅ 测试验证

### 功能测试
- ✅ 倒计时正确计算
- ✅ 每秒自动更新
- ✅ 跨天自动切换
- ✅ 紧急状态动画
- ✅ 任务启动后隐藏

### 兼容性测试
- ✅ Chrome/Edge
- ✅ Firefox
- ✅ Safari
- ✅ 移动端浏览器

---

## 📝 注意事项

1. **时区设置**：倒计时使用本地时间，确保系统时区设置为北京时间（UTC+8）
2. **浏览器时间**：倒计时依赖浏览器本地时间，请确保系统时间准确
3. **页面刷新**：刷新页面不会影响后台任务，倒计时会自动恢复
4. **跨天逻辑**：如果当前时间已过19:59:55，倒计时会自动显示到明天

---

## 🎉 效果预览

### 正常状态（距离启动2小时34分56秒）
```
⏰ 距离启动倒计时

┌────┐  ┌────┐  ┌────┐
│ 02 │  │ 34 │  │ 56 │
│小时│  │分钟│  │ 秒 │
└────┘  └────┘  └────┘

启动时间: 19:59:55
抢座开放: 20:00:00
当前时间: 17:25:09
```

### 紧急状态（距离启动3分钟）
```
🔥 即将启动！

┌────┐  ┌────┐  ┌────┐
│ 00 │  │ 03 │  │ 45 │  ← 红色脉动
│小时│  │分钟│  │ 秒 │
└────┘  └────┘  └────┘
```

### 最后冲刺（距离启动30秒）
```
⚡ 30秒后启动！

┌────┐  ┌────┐  ┌────┐
│ 00 │  │ 00 │  │ 30 │  ← 快速脉动
│小时│  │分钟│  │ 秒 │
└────┘  └────┘  └────┘
```

---

**功能添加完成时间**：2025-12-06 20:20
**状态**：✅ 已部署并运行
**访问地址**：http://localhost:8899/static/status.html
