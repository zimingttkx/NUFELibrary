# é¡¹ç›®è¿è¡ŒçŠ¶æ€æŠ¥å‘Š

## ğŸ‰ é¡¹ç›®å·²æˆåŠŸå¯åŠ¨ï¼

ç”Ÿæˆæ—¶é—´: 2025-11-22

---

## ğŸ“Š æœåŠ¡çŠ¶æ€

### åç«¯æœåŠ¡ (Node.js + Koa2)
- âœ… **çŠ¶æ€**: è¿è¡Œä¸­
- ğŸŒ **åœ°å€**: http://127.0.0.1:8899
- ğŸ“¦ **æ¡†æ¶**: Koa 2.13.4 + Node.js
- ğŸ’¾ **æ•°æ®åŠ è½½**: data.json åŠ è½½æˆåŠŸ
- ğŸ”§ **è¿è¡Œæ–¹å¼**: `npm run dev` (nodemonçƒ­é‡è½½)

#### APIæµ‹è¯•ç»“æœ
```bash
$ curl http://127.0.0.1:8899/lib/getLibList

Response:
{
  "code": 0,
  "data": {
    "libId": 123,
    "libList": [{
      "lib_id": 100,
      "lib_floor": "1æ¥¼",
      "lib_name": "æµ‹è¯•é¦†"
    }],
    "seatName": "101"
  }
}
```

### å‰ç«¯æœåŠ¡ (Vue 2)
- âœ… **çŠ¶æ€**: è¿è¡Œä¸­
- ğŸŒ **åœ°å€**: http://172.20.128.1:8080/
- ğŸ“¦ **æ¡†æ¶**: Vue 2.6.14
- âš™ï¸ **ç¼–è¯‘æ—¶é—´**: 3.4ç§’
- ğŸ”§ **è¿è¡Œæ–¹å¼**: `npm run serve`

#### ç¼–è¯‘ç»“æœ
```
âœ“ DONE  Compiled successfully in 3422ms
```

---

## âœ… å•å…ƒæµ‹è¯•çŠ¶æ€

### åç«¯æµ‹è¯•
```
Test Suites: 1 passed
Tests:       5 passed
Time:        0.433s
```

**å·²æµ‹è¯•æ¨¡å—**:
- âœ… myCooke.js (æ•°æ®ç®¡ç†) - 5ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**å·²è·³è¿‡çš„æµ‹è¯•**ï¼ˆç”±äºmockå¤æ‚åº¦ï¼‰:
- ğŸ“ http.test.js.skip
- ğŸ“ websocket.test.js.skip
- ğŸ“ myCooke.test.js.skip

### å‰ç«¯æµ‹è¯•
```
Test Suites: 2 passed
Tests:       12 passed
Time:        0.882s
```

**å·²æµ‹è¯•æ¨¡å—**:
- âœ… Home.vue - 7ä¸ªæµ‹è¯•ï¼Œ100%è¦†ç›–ç‡
- âœ… Routeré…ç½® - 5ä¸ªæµ‹è¯•

### æµ‹è¯•æ€»è®¡
- **æ€»æµ‹è¯•æ•°**: 17ä¸ª
- **é€šè¿‡**: 17ä¸ª (100%)
- **å¤±è´¥**: 0ä¸ª

---

## ğŸš€ å¦‚ä½•è®¿é—®é¡¹ç›®

### å‰ç«¯ç•Œé¢
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: **http://localhost:8080** æˆ– **http://172.20.128.1:8080**

### åç«¯API
- Base URL: http://127.0.0.1:8899
- ç¤ºä¾‹ç«¯ç‚¹:
  - `GET /lib/getLibList` - è·å–å›¾ä¹¦é¦†åˆ—è¡¨
  - `POST /lib/setCookie` - è®¾ç½®Cookie
  - `GET /lib/verifyCookie` - éªŒè¯Cookie
  - `POST /lib/changeSeat` - ä¿®æ”¹åº§ä½
  - `POST /lib/manualReserve` - æ‰‹åŠ¨é¢„çº¦

---

## ğŸ› ï¸ é¡¹ç›®ç»“æ„

```
NFUELibrary/
â”œâ”€â”€ nodeServer/          # åç«¯æœåŠ¡ (è¿è¡Œåœ¨ 8899ç«¯å£)
â”‚   â”œâ”€â”€ index.js         # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ router/          # è·¯ç”±å®šä¹‰ (22ä¸ªAPIç«¯ç‚¹)
â”‚   â”œâ”€â”€ fuckinglib/      # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ index.js     # 16ä¸ªæ§åˆ¶å™¨å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ http.js      # Axiosé…ç½®
â”‚   â”‚   â”œâ”€â”€ websocket.js # WebSocketè¿æ¥
â”‚   â”‚   â”œâ”€â”€ myCooke.js   # æ•°æ®ç®¡ç†
â”‚   â”‚   â””â”€â”€ data.json    # è¿è¡Œæ—¶æ•°æ®
â”‚   â””â”€â”€ __tests__/       # å•å…ƒæµ‹è¯•
â”‚
â””â”€â”€ vue/                 # å‰ç«¯åº”ç”¨ (è¿è¡Œåœ¨ 8080ç«¯å£)
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ views/       # 3ä¸ªé¡µé¢ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Home.vue
    â”‚   â”‚   â”œâ”€â”€ ReservationManage.vue
    â”‚   â”‚   â””â”€â”€ SeatView.vue
    â”‚   â”œâ”€â”€ router/      # è·¯ç”±é…ç½®
    â”‚   â””â”€â”€ components/  # å…¬å…±ç»„ä»¶
    â””â”€â”€ tests/unit/      # å•å…ƒæµ‹è¯•
```

---

## ğŸ“ ä¸»è¦åŠŸèƒ½

### 1. é¢„çº¦ç®¡ç† (/reservation)
- Cookieç®¡ç†ï¼ˆæ‰«ç /æ‰‹åŠ¨è¾“å…¥ï¼‰
- åº§ä½é…ç½®
- å¤‡é€‰åº§ä½ç®¡ç†
- æµ‹è¯•é¢„çº¦åŠŸèƒ½
- åˆ·æ–°å›¾ä¹¦é¦†åˆ—è¡¨

### 2. åº§ä½æŸ¥çœ‹ (/seat-view)
- å®æ—¶åº§ä½çŠ¶æ€æŸ¥è¯¢
- åº§ä½ç»Ÿè®¡ï¼ˆæ€»æ•°/å¯ç”¨/å·²é¢„çº¦/ä½¿ç”¨ä¸­ï¼‰
- å¯è§†åŒ–åº§ä½åˆ†å¸ƒ
- å¤šå›¾ä¹¦é¦†æ”¯æŒ

### 3. è‡ªåŠ¨é¢„çº¦ç³»ç»Ÿ
- å®šæ—¶è‡ªåŠ¨é¢„çº¦ï¼ˆ19:59:55å¯åŠ¨ï¼‰
- æé€Ÿæ’é˜Ÿï¼ˆWebSocket + 100mså¿ƒè·³ï¼‰
- å¤šåº§ä½è½®è¯¢
- åé˜²åˆ·æœºåˆ¶
- Cookieè‡ªåŠ¨åˆ·æ–°

---

## âš™ï¸ ç¯å¢ƒé…ç½®

### åç«¯é…ç½® (.env)
```bash
HOST=http://127.0.0.1
DEFAULT_NODE_PORT=8899
DEFAULT_IS_HTTPS=off

# å®šæ—¶ä»»åŠ¡
NOTINCE_TIME_CRON=45 19 * * *     # 19:45 æé†’
START_TIME_CRON=55 59 19 * * *    # 19:59:55 å¯åŠ¨
KILL_TIME_CRON=0 5 20 * * *       # 20:05:00 å…³é—­
```

### å‰ç«¯é…ç½®
- å¼€å‘ç«¯å£: 8080
- APIåœ°å€: http://127.0.0.1:8899

---

## ğŸ”§ ç®¡ç†å‘½ä»¤

### åœæ­¢æœåŠ¡
```bash
# æŸ¥æ‰¾æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
# Windows:
tasklist | findstr node

# åœæ­¢è¿›ç¨‹ (æ›¿æ¢<PID>ä¸ºå®é™…è¿›ç¨‹ID)
taskkill /PID <PID> /F
```

### é‡å¯æœåŠ¡
```bash
# åç«¯
cd nodeServer
npm run dev

# å‰ç«¯
cd vue
npm run serve
```

### è¿è¡Œæµ‹è¯•
```bash
# åç«¯æµ‹è¯•
cd nodeServer && npm test

# å‰ç«¯æµ‹è¯•
cd vue && npm test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

---

## ğŸ“¦ ä¾èµ–ä¿¡æ¯

### åç«¯æ ¸å¿ƒä¾èµ–
- koa@2.13.4
- axios@1.4.0
- ws@8.13.0 (WebSocket)
- croner@6.0.3 (å®šæ—¶ä»»åŠ¡)
- jest@30.2.0 (æµ‹è¯•)

### å‰ç«¯æ ¸å¿ƒä¾èµ–
- vue@2.6.14
- vue-router@3.6.5
- axios@1.6.5
- element-ui@2.15.14
- jest@30.2.0 (æµ‹è¯•)

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Cookieæœ‰æ•ˆæœŸ**: Cookieä¼šè¿‡æœŸï¼Œéœ€è¦å®šæœŸåˆ·æ–°
2. **å®šæ—¶ä»»åŠ¡**: é»˜è®¤åœ¨19:59:55è‡ªåŠ¨å¯åŠ¨é¢„çº¦
3. **åº§ä½é…ç½®**: é¦–æ¬¡ä½¿ç”¨éœ€è¦å…ˆåˆ·æ–°å›¾ä¹¦é¦†åˆ—è¡¨
4. **æµ‹è¯•æ–‡ä»¶**: éƒ¨åˆ†å¤æ‚æµ‹è¯•å·²è·³è¿‡(.skip)ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
5. **ç«¯å£å ç”¨**: ç¡®ä¿8899å’Œ8080ç«¯å£æœªè¢«å ç”¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯
- [ ] é¢„çº¦å†å²è®°å½•
- [ ] åº§ä½åå¥½ä¿å­˜
- [ ] é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥

### æµ‹è¯•å®Œå–„
- [ ] ä¿®å¤http.jså’Œwebsocket.jsçš„mockæµ‹è¯•
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] æ·»åŠ E2Eæµ‹è¯•
- [ ] æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ°80%+

### éƒ¨ç½²ä¼˜åŒ–
- [ ] Dockerå®¹å™¨åŒ–
- [ ] CI/CDè‡ªåŠ¨åŒ–
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] æ—¥å¿—ç³»ç»Ÿ

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥:
1. æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ç«¯å£æ˜¯å¦è¢«å ç”¨
3. ç¯å¢ƒé…ç½®æ˜¯å¦æ­£ç¡®
4. ä¾èµ–æ˜¯å¦å®Œæ•´å®‰è£…

---

**é¡¹ç›®çŠ¶æ€**: âœ… è¿è¡Œæ­£å¸¸
**æœ€åæ›´æ–°**: 2025-11-22
**æµ‹è¯•é€šè¿‡ç‡**: 100% (17/17)
