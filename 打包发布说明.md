# 项目打包发布说明

本文档说明如何将项目打包成压缩包，供用户下载后零配置运行。

---

## 📦 打包前准备

### 1. 清理不必要的文件

在打包前，建议清理以下文件和目录（减小压缩包体积）：

#### 必须排除的目录
- `node_modules/` - 依赖包（启动脚本会自动安装）
- `.git/` - Git版本控制（不需要分发）
- `logs/` - 运行日志（运行时自动创建）
- `.idea/`, `.vscode/` - IDE配置文件

#### 可选排除的文件
- `*.log` - 日志文件
- `.env.local` - 本地环境配置
- `dist/` - 构建输出（如果有）
- `coverage/` - 测试覆盖率报告（如果有）

### 2. 确保必需文件存在

打包时必须包含以下文件：

#### 启动脚本（必需）
- ✅ `双击启动.bat` - Windows零配置启动
- ✅ `双击启动.sh` - Linux/Mac零配置启动
- ✅ `start.bat` - Windows传统启动
- ✅ `start.sh` - Linux/Mac传统启动
- ✅ `install.bat` - Windows安装脚本
- ✅ `install.sh` - Linux/Mac安装脚本
- ✅ `stop.bat` - Windows停止脚本
- ✅ `stop.sh` - Linux/Mac停止脚本

#### 说明文档（必需）
- ✅ `快速开始.md` - 超简化使用说明
- ✅ `一键启动说明.md` - 详细使用说明
- ✅ `README_CN.md` - 项目完整文档

#### 源代码（必需）
- ✅ `nodeServer/` - 后端源码（不包含node_modules）
- ✅ `vue/` - 前端源码（不包含node_modules）
- ✅ `package.json` - 项目依赖配置（如果有）

---

## 🗜️ 打包步骤

### 方法一：使用 Git（推荐）

```bash
# 1. 确保所有改动已提交
git status

# 2. 使用 git archive 打包（自动排除 .gitignore 中的文件）
git archive --format=zip --output=NFUELibrary-v1.0.0.zip HEAD

# 或者使用 tar.gz 格式（Linux/Mac推荐）
git archive --format=tar.gz --output=NFUELibrary-v1.0.0.tar.gz HEAD
```

**优点**：
- 自动排除 `.gitignore` 中的文件
- 确保打包的是已提交的稳定版本
- 文件结构清晰

### 方法二：手动压缩

#### Windows
1. 删除或排除以下目录：
   - `nodeServer/node_modules/`
   - `vue/node_modules/`
   - `.git/`
   - `logs/`

2. 选中项目根目录下的所有文件和文件夹
3. 右键 → 发送到 → 压缩(zipped)文件夹
4. 重命名为 `NFUELibrary-v1.0.0.zip`

#### Linux/Mac
```bash
# 进入项目父目录
cd /path/to/parent

# 压缩项目（排除不必要的文件）
tar -czf NFUELibrary-v1.0.0.tar.gz \
  --exclude='node_modules' \
  --exclude='.git' \
  --exclude='logs' \
  --exclude='.idea' \
  --exclude='.vscode' \
  --exclude='*.log' \
  NUFELibrary/

# 或使用 zip 格式
zip -r NFUELibrary-v1.0.0.zip NUFELibrary/ \
  -x "*/node_modules/*" \
  -x "*/.git/*" \
  -x "*/logs/*" \
  -x "*/.idea/*" \
  -x "*/.vscode/*" \
  -x "*.log"
```

### 方法三：使用打包脚本（自动化）

创建一个自动打包脚本：

**pack.sh (Linux/Mac)**
```bash
#!/bin/bash
VERSION="1.0.0"
PROJECT_NAME="NFUELibrary"
OUTPUT_FILE="${PROJECT_NAME}-v${VERSION}.tar.gz"

echo "开始打包 ${PROJECT_NAME} v${VERSION}..."

# 清理临时文件
echo "清理临时文件..."
rm -rf nodeServer/node_modules
rm -rf vue/node_modules
rm -rf logs
rm -f *.log

# 打包
echo "创建压缩包..."
cd ..
tar -czf "${OUTPUT_FILE}" \
  --exclude='node_modules' \
  --exclude='.git' \
  --exclude='logs' \
  --exclude='.idea' \
  --exclude='.vscode' \
  --exclude='*.log' \
  "${PROJECT_NAME}/"

echo "✅ 打包完成: ${OUTPUT_FILE}"
echo "📦 文件大小: $(du -h ${OUTPUT_FILE} | cut -f1)"
```

**pack.bat (Windows)**
```batch
@echo off
set VERSION=1.0.0
set PROJECT_NAME=NFUELibrary
set OUTPUT_FILE=%PROJECT_NAME%-v%VERSION%.zip

echo 开始打包 %PROJECT_NAME% v%VERSION%...

echo 清理临时文件...
if exist nodeServer\node_modules rmdir /s /q nodeServer\node_modules
if exist vue\node_modules rmdir /s /q vue\node_modules
if exist logs rmdir /s /q logs
del /q *.log 2>nul

echo 创建压缩包...
powershell Compress-Archive -Path * -DestinationPath ..\%OUTPUT_FILE% -Force

echo 打包完成: %OUTPUT_FILE%
pause
```

---

## 📋 打包检查清单

在发布前，请确认：

### 文件完整性
- [ ] 包含所有启动脚本（双击启动.bat/.sh, start.bat/.sh等）
- [ ] 包含说明文档（快速开始.md, 一键启动说明.md）
- [ ] 包含源代码（nodeServer/, vue/）
- [ ] 包含配置文件（package.json, .env等）
- [ ] **不包含** node_modules 目录
- [ ] **不包含** .git 目录
- [ ] **不包含** logs 目录

### 脚本可执行性
- [ ] 双击启动.sh 有执行权限（`chmod +x`）
- [ ] start.sh 有执行权限
- [ ] install.sh 有执行权限
- [ ] stop.sh 有执行权限

### 文档完整性
- [ ] 快速开始.md 说明清晰简洁
- [ ] 一键启动说明.md 包含详细步骤
- [ ] README_CN.md 项目信息完整

---

## 📤 发布流程

### 1. 创建压缩包

使用上述任一方法创建压缩包。

### 2. 测试压缩包

**重要**：在发布前，在全新环境测试：

1. 将压缩包复制到一台**全新**的测试电脑（或虚拟机）
2. 解压压缩包
3. Windows: 双击 `双击启动.bat`
4. Linux/Mac: 运行 `chmod +x 双击启动.sh && ./双击启动.sh`
5. 确认能够自动安装依赖并启动成功

### 3. 发布到平台

可以发布到以下平台：

#### GitHub Releases
```bash
# 1. 创建标签
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0

# 2. 在 GitHub 上创建 Release
# 3. 上传压缩包
```

#### 其他平台
- Gitee Releases
- 百度网盘 / 阿里云盘（附带快速开始.md）
- 自建下载服务器

---

## 📝 发布说明模板

在发布时，建议附上以下说明：

```markdown
# NFUELibrary 图书馆自动预约系统 v1.0.0

## 🚀 零配置运行

### Windows 用户
1. 下载并解压 `NFUELibrary-v1.0.0.zip`
2. 双击 `双击启动.bat`
3. 等待浏览器自动打开

### Linux/Mac 用户
1. 下载并解压 `NFUELibrary-v1.0.0.tar.gz`
2. 运行：
   ```bash
   chmod +x 双击启动.sh
   ./双击启动.sh
   ```
3. 等待浏览器自动打开

## ✨ 特性

- ✅ **零配置运行**：无需提前安装 Node.js 或任何依赖
- ✅ **自动安装环境**：脚本自动检测并安装 Node.js
- ✅ **自动安装依赖**：首次运行自动安装所有项目依赖
- ✅ **一键启动**：双击即可启动前后端服务
- ✅ **自动打开浏览器**：服务启动后自动打开页面

## 📖 详细文档

解压后查看以下文件：
- `快速开始.md` - 3秒上手指南
- `一键启动说明.md` - 详细使用说明

## 🔧 系统要求

- Windows 7/8/10/11 或 Linux 或 macOS
- 网络连接（用于下载 Node.js 和依赖）
- 2GB 可用磁盘空间

## 🎯 首次运行

首次运行需要下载依赖，可能需要 3-5 分钟，请耐心等待。
后续运行只需 40-60 秒。

## 📞 问题反馈

遇到问题？请查看项目文档或提交 Issue。
```

---

## 🔄 版本更新

### 版本号规范

采用 [语义化版本](https://semver.org/lang/zh-CN/)：

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

示例：
- `v1.0.0` - 初始发布版本
- `v1.0.1` - Bug修复
- `v1.1.0` - 新增功能
- `v2.0.0` - 重大更新

### 更新日志

每次发布时维护 `CHANGELOG.md`：

```markdown
# 更新日志

## [1.0.1] - 2025-11-24
### 修复
- 修复 Windows 下中文路径问题
- 修复端口占用检测逻辑

### 优化
- 提升首次启动速度
- 优化错误提示信息

## [1.0.0] - 2025-11-23
### 新增
- 首次发布
- 零配置一键启动功能
- 自动安装 Node.js 功能
```

---

## ⚠️ 注意事项

### 安全检查

1. **不要**包含敏感信息：
   - 数据库密码
   - API密钥
   - 个人凭证
   - `.env` 中的敏感配置

2. **检查**配置文件：
   - 使用示例配置或默认配置
   - 敏感信息使用环境变量

### 文件大小

- 不包含 node_modules：约 10-50 MB
- 包含 node_modules：约 200-500 MB（不推荐）

**建议**：不包含 node_modules，让启动脚本自动安装。

### 跨平台兼容

- 使用 UTF-8 编码所有文本文件
- 使用 LF 行尾（不是 CRLF）
- 测试所有平台的启动脚本

---

## 🎉 完成！

按照以上步骤，你就可以创建一个用户友好的零配置发行包了！

用户只需：
1. 下载
2. 解压
3. 双击启动

就能运行你的项目！
